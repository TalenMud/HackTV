{% extends 'base.html' %}
{% block title %}HackTV - Create Stream{% endblock %}

{% block sidebar_selected %}
<div class="hidden" id="sidebar_selected">homeContainer</div>
{% endblock %}

{% block content%}
    <div class="container relative top-[20vh] w-full h-full flex flex-col justify-center items-center">

      <!--Stream form-->
      <form method="POST" action="/createstream" id="stream-start-form" class="flex flex-col items-center justify-center">

            <h1 class="font-[Silkscreen] text-3xl underline text-white mb-4">Create Stream</h1>

            <fieldset>
              <label class="m-4 flex items-center font-[Varela]">
    Stream Title<span class="text-red-400">*</span>:
    <input type="text" id="stream-title" name="stream-title" class="mx-4 inpt w-[20rem] h-[2.5rem]" placeholder="For ex. 'Let's make a keyboard together!'" required>
  </label>

  <label class="m-4 flex items-center font-[Varela]">
      Stream Description:
      <textarea type="text" id="stream-desc" name="stream-desc" class="mx-4 pt-2 inpt w-[20rem] h-[10rem]" placeholder="For ex. 'In this stream I plan to teach others how to make a keyboard from scratch!' "></textarea>
    </label>

  <label class="m-4 flex items-center font-[Varela]">
      Stream Thumbnail<span class="text-red-400">*</span>:
      <input type="file" id="stream-thumb" value="browse" name="stream-thumb" class="mx-4"></input>
    </label>

    <!--<button id="view-stream" class="bg-green-500 text-white p-3 rounded-lg mt-5 hidden">View Stream</button>-->
    <!--<span id="peer-id" class="text-white font-bold"></span>-->

    <button type="submit" id="start-stream" class="flex items-center justify-center font-[Varela] m-4 activeButton text-white w-[10rem] h-[4rem]" style="margin: 16px auto;">
          Start <svg fill="#ffffff" style="margin-left:1rem;" width="2rem" height="2rem" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g id="Stream_On" data-name="Stream On"> <g> <path d="M6.26,19.089A9.625,9.625,0,0,1,6.234,4.911C6.709,4.475,6,3.769,5.527,4.2A10.516,10.516,0,0,0,5.553,19.8c.475.433,1.184-.273.707-.707Z"></path> <path d="M8.84,15.706a5.024,5.024,0,0,1-.014-7.412c.474-.437-.234-1.143-.707-.707a6.028,6.028,0,0,0,.014,8.826c.474.434,1.183-.272.707-.707Z"></path> <circle cx="12" cy="12" r="1.244"></circle> <path d="M17.74,4.911a9.625,9.625,0,0,1,.026,14.178c-.475.436.234,1.142.707.707A10.516,10.516,0,0,0,18.447,4.2c-.475-.433-1.184.273-.707.707Z"></path> <path d="M15.16,8.294a5.024,5.024,0,0,1,.014,7.412c-.474.437.234,1.143.707.707a6.028,6.028,0,0,0-.014-8.826c-.474-.434-1.183.272-.707.707Z"></path> </g> </g> </g></svg>
      </button>
      </form>
            </fieldset>

      <!--Video upload form-->

        <hr class="text-[#202020] bg-[#202020] border-2 border-[#202020] my-8" height="2px" width="100%">

      <form class="flex flex-col items-center justify-center">

            <h1 class="font-[Silkscreen] text-3xl underline text-white mb-4">Upload Video</h1>

            <fieldset>
  <label class="m-4 flex items-center font-[Varela]">
    <span>Video Title<span class="text-red-400">*</span>:</span>
    <input type="stream-title" name="stream-title" class="mx-4 inpt w-[20rem] h-[2.5rem]" placeholder="For ex. 'Made a content streaming website!'" required>
  </label>

  <label class="m-4 flex items-center font-[Varela]">
      Video Description:
      <textarea type="stream-title" name="stream-title" class="pt-2 mx-4 inpt w-[20rem] h-[10rem]" placeholder="For ex. 'This project is basically a media streaming website for hackclub, people can upload their project videos and more, along with live streams! Somewhat like FOSS youtube but for Hackclub:)'"></textarea>
    </label>

  <label class="m-4 flex items-center font-[Varela]">
      <span>Video<span class="text-red-400">*</span>:</span>
      <input type="file" name="stream-thumb" class="mx-4 " required></input>
    </label>

  <label class="m-4 flex items-center font-[Varela]">
      Video Thumbnail<span class="text-red-400">*</span>:
      <input type="file" name="stream-thumb" class="mx-4 " required></input>
    </label>
        
      <button id="create-video-btn" class="flex flex-row items-center justify-center m-4 activeButton text-white w-[10rem] h-[4rem] font-[Varela]" style="margin: 16px auto;">
            Upload Video <svg viewBox="0 0 24 24" width="2rem" height="2rem" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M15 21H9C6.17157 21 4.75736 21 3.87868 20.1213C3 19.2426 3 17.8284 3 15M21 15C21 17.8284 21 19.2426 20.1213 20.1213C19.8215 20.4211 19.4594 20.6186 19 20.7487" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M12 16V3M12 3L16 7.375M12 3L8 7.375" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
        </button>
        
      </fieldset>
      </form>


        <div id="stream-tabs" class="mt-4 flex space-x-4"></div>

        <div class="mt-4">
            <button id="start-stream-btn" class="bg-green-500 text-white p-2 rounded hover:bg-green-600 focus:outline-none" style="display:none;">
                Start Stream
            </button>
            <button id="stop-btn" class="bg-red-500 text-white p-2 rounded hover:bg-red-600 focus:outline-none" style="display:none;">
                Stop Streaming
            </button>
        </div>

    </div>
{% endblock%}

{% block script%}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    const startButton = document.getElementById('start-streaming');
    const viewButton = document.getElementById('view-stream');
    const peerIdSpan = document.getElementById('peer-id');
    const localVideo = document.getElementById('local-video');
    const remoteVideo = document.getElementById('remote-video');

    let peer;
    let localStream;
    let call;
/*
    startButton.onclick = async function() {
      try {
        localStream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: true });
        localVideo.srcObject = localStream;

        peer = new Peer();

        peer.on('open', (id) => {
          peerIdSpan.textContent = `My Peer ID: ${id}`;
          startButton.style.display = 'none';
          viewButton.style.display = 'inline-block';
        });

        peer.on('call', function(call) {
          call.answer(localStream);
          call.on('stream', function(remoteStream) {
            remoteVideo.srcObject = remoteStream;
            remoteVideo.style.display = 'block';
          });
        });
      } catch (err) {
        console.error("Error getting user media:", err);
      }
    };

    viewButton.onclick = function() {
      Swal.fire({
        title: 'Enter Peer ID to view stream',
        input: 'text',
        showCancelButton: true,
        confirmButtonText: 'Connect',
        showLoaderOnConfirm: true,
        preConfirm: (peerId) => {
          const remotePeerId = peerId.trim();
          if (remotePeerId) {
            call = peer.call(remotePeerId, localStream);

            call.on('stream', function(remoteStream) {
              remoteVideo.srcObject = remoteStream;
              remoteVideo.style.display = 'block';
            });
          } else {
            Swal.showValidationMessage('Please enter a valid Peer ID');
          }
        },
        allowOutsideClick: false
      });
    };
    */

    function generateUUID() {
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
            const r = Math.random() * 16 | 0;
            const v = (c === 'x' ? r : (r & 0x3 | 0x8));
            return v.toString(16);
        });
    }
    // streamForm=document.getElementById("stream-start-form");
    // streamForm.action="/watch/"+generateUUID();
  </script>

  <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

{% endblock %}
